# GhidraXenon

A lightweight Ghidra extension that adds Xbox 360 (Xenon) PowerPC support with VMX128 vector instructions.

This is the extension-only distribution of the Xenon work from our [Ghidra fork with Xenon support][ghidra-fork]. If you want everything working out of the box (including the MSVC switch analyzer fix), use the [full Ghidra build][full-build] instead. This extension is for users who want to add Xenon disassembly support to their existing stock Ghidra install.

## Install

Requires [Ghidra 12.1][ghidra-releases] (stock public release).

1. Download `ghidra_12.1_PUBLIC_*_GhidraXenon.zip` from the [Releases][releases] page
2. Open Ghidra
3. **File** -> **Install Extensions...** -> click the **+** icon
4. Select the downloaded zip
5. Restart Ghidra

After restart, `PowerPC:BE:64:Xenon` will appear in the language selection list when importing a binary.

## What's Included

### Xenon Language (`PowerPC:BE:64:Xenon`)

A SLEIGH language definition for the Xbox 360's Xenon CPU: PowerPC 64-bit in big-endian mode with 32-bit addressing, AltiVec, and the VMX128 vector extension (77 opcodes). This covers the full instruction set used by Xbox 360 game executables.

The language uses the `ppc_64_32` calling convention (64-bit registers, 32-bit pointers) which matches the Xbox 360 ABI.

### Ghidra Scripts

| Script | Description |
|--------|-------------|
| `RecoverMSVCSwitchTables.java` | Recovers switch/case table structures generated by the Xbox 360 MSVC compiler. Run this after auto-analysis to fix control flow for functions containing switch statements. |
| `TestMSVCSwitchRecovery.java` | Validation script for testing switch table recovery results. |
| `ApplyMapSymbols.java` | Imports symbols from a `.map` file (linker map) and applies them to the current program. Useful when you have debug symbols from the build process. |

## Usage

### Importing an Xbox 360 executable

1. Install a XEX loader extension (e.g. XEXLoaderWV) if you haven't already
2. **File** -> **Import File...** -> select your `.xex` file
3. If the loader doesn't auto-select the language, manually choose **PowerPC:BE:64:Xenon**
4. Click **OK** and let auto-analysis run

### Recovering MSVC switch tables

The stock Ghidra PowerPC analyzer doesn't handle switch tables generated by the Xbox 360's MSVC compiler. This extension does **not** patch the built-in analyzer (that requires the full build), but ships a script that does the same job:

1. Open your analyzed program in the CodeBrowser
2. **Script Manager** -> search for `RecoverMSVCSwitchTables`
3. Run the script
4. The script will scan all functions and recover switch table control flow

You can also bind the script to a keyboard shortcut or toolbar button for convenience.

## What's NOT Included

This extension does **not** include the patched `PowerPCAddressAnalyzer.java` that fixes MSVC switch detection during auto-analysis. That fix modifies a core Ghidra Java class which can't be cleanly overridden from an extension (both the core and extension versions would load, causing conflicts). For automatic switch recovery during analysis, use the [full Ghidra build][full-build] from the fork.

## Building from Source

The SLEIGH source files are included in this repository for reference and recompilation. The complete dependency tree for `ppc_64_xenon.slaspec` is present in `data/languages/`.

### Packaging the extension zip

```
./build_extension.sh 12.1
```

This produces a `ghidra_12.1_PUBLIC_*_GhidraXenon.zip` ready for installation.

### Recompiling the SLEIGH specification

If you modify `vmx128.sinc`, `altivec.sinc`, or any other `.sinc` file, you'll need to recompile:

```
<ghidra_install>/support/sleigh data/languages/ppc_64_xenon.slaspec
```

This regenerates `ppc_64_xenon.sla` from the source files.

## File Inventory

```
ghidra-xenon-extension/
├── extension.properties                    # Extension metadata
├── Module.manifest                         # Ghidra module manifest (empty)
├── build_extension.sh                      # Packaging script
├── data/languages/
│   ├── ppc_xenon.ldefs                     # Language definition (Xenon only)
│   ├── ppc_64_xenon.sla                    # Compiled SLEIGH (runtime)
│   ├── ppc_64_32.cspec                     # Compiler specification
│   ├── ppc_64.pspec                        # Processor specification
│   ├── ppc.dwarf                           # DWARF register mappings
│   ├── ppc_64_xenon.slaspec                # SLEIGH top-level source
│   ├── vmx128.sinc                         # VMX128 instruction definitions
│   ├── altivec.sinc                        # AltiVec instructions (modified)
│   └── [12 more .sinc files]              # Transitive SLEIGH includes
└── ghidra_scripts/
    ├── RecoverMSVCSwitchTables.java
    ├── TestMSVCSwitchRecovery.java
    └── ApplyMapSymbols.java
```

### Why `ppc_xenon.ldefs` instead of `ppc.ldefs`?

Ghidra scans all modules and extensions for `.ldefs` files to build its language registry. If this extension shipped a file named `ppc.ldefs`, it could conflict with the identically-named file in the core PowerPC module. Using a distinct filename (`ppc_xenon.ldefs`) avoids this. The language ID `PowerPC:BE:64:Xenon` is unique and won't collide with any stock Ghidra language.

[ghidra-fork]: https://github.com/freeqaz/ghidra
[full-build]: https://github.com/freeqaz/ghidra/releases
[releases]: https://github.com/freeqaz/ghidra-xenon-extension/releases
[ghidra-releases]: https://github.com/NationalSecurityAgency/ghidra/releases
